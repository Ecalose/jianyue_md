> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.52pojie.cn](https://www.52pojie.cn/thread-2011345-1-1.html) ![](https://static.52pojie.cn/static/image/common/online_member.gif) [littlewhite11](home.php?mod=space&uid=2327812) _发表于 2025-3-4 15:32_<table cellspacing="0" cellpadding="0"><tbody><tr><td class="t_f" id="postmessage_52512554"><i class="pstatus">本帖最后由 littlewhite11 于 2025-3-4 15:33 编辑</i><br><h4 id="52512554_逆向目标" class="">逆向目标</h4><ul><li class="">网址：<code>aHR0cHM6Ly93d3cubGFuZGNoaW5hLmNvbS8jLw==</code></li><li>目标：反调试及请求头<code>Hash</code></li></ul><h4 id="52512554_反调试">反调试</h4><p>进入网站，我们会发现<code>F12</code>无法打开控制台。那就换一种方式，以谷歌浏览器为例<code>设置 -&gt; 更多工具 -&gt; 开发者工具</code>，然后网页就会跳到空白页了，这是除了<code>debugger</code>外一种经典的反调试手段。</p><p>那么我们如何过掉这个反调试呢？目前，我遇到的就两种情况，第一种就是<code>window.close()</code>，第二种就是<code>location.href = ''</code>，还有其他情况的话欢迎各位大佬补充。</p><p>下面直接开始分析：</p><p>我们用无痕浏览器分析（因为在<code>Script</code>断点时不会加载插件的JS代码），打开控制台，勾上<code>Script</code>断点，输入网址，成功断住。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/152953qdpdeiipi2isup2s.png" alt="1.png" title="1.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>然后我们先搜索<code>window.close</code>，<code>F8</code>一直走，之后某个文件出现了相关代码，直接下断。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/152955ywmmwuu2277m7pkk.png" alt="2.png" title="2.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>然后放开<code>Script</code>断点，直接<code>F8</code>过掉，成功在断点处停住。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/152957gd4q7o1g1b7xtbr9.png" alt="3.png" title="3.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>我们往前跟栈，看网站通过什么手段进行的反调试。可以看到，是<code>e &gt; 10 * this.maxPrintTime</code>这个条件成立才触发<code>this.onDevToolOpen</code>，从而触发后续的<code>window.close</code></p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153000mpyryyzyzx4o0rrv.png" alt="4.png" title="4.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>那我们就看看代码具体做了什么，我们在前面的<code>e</code>和<code>r</code>处下断，重新请求，成功断住。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153002nqagooucrc9r1r9m.png" alt="5.png" title="5.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>然后我们单步跟进去<code>m</code>函数，可以看到，先取了一下时间戳，然后调用传进的参数，最后再返回参数调用的时间差，那猫腻肯定是出现在传入的函数中了。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153004rfssu0aan3pkuhsh.png" alt="6.png" title="6.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>我们直接进入被调用的参数函数中，可以看到<code>t.largeObjectArray</code>是一个大对象，<code>b</code>其实是<code>console.table</code>函数，也就是在控制台打印一个大对象。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153006mli2xs3ih3x6hli3.png" alt="7.png" title="7.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>那反调试的逻辑大体清楚了：如果打开了控制台，就会通过<code>console.table</code>打印一个很大的对象，这就需要消耗时间，后续<code>e &gt; 10 * this.maxPrintTime</code>就成立，就会进入最终<code>window.close</code>的逻辑。</p><p>我们可以通过<code>hook</code>，返回一个固定的时间戳来过掉反调试（油猴或者直接在控制台注入都可以）。</p><pre><em class="CopyMyCode" style="cursor: pointer; font-size: 12px; color: rgb(51, 102, 153) !important;"> 复制代码</em><em class="hideCode" style="cursor: pointer; font-size: 12px; color: rgb(51, 102, 153) !important;"> 隐藏代码<br></em><code class="js hljs language-javascript">Date.prototype.getTime = function(){
&nbsp; &nbsp; return 1741067137856
}</code></pre><p><code>hook</code>掉时间戳之后，我们会发现控制台一直会被清空，也不利于调试，我们直接把清空控制台的代码置为空函数<code>E = function(){}</code>。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153008q3td3mbztdkmjzkt.png" alt="8.png" title="8.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>同理，再把和控制台打印相关的<code>b</code>和<code>w</code>函数也置空（在对应函数断住的时候去置空）。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153010l1nl98y22ly8l3g1.png" alt="9.png" title="9.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>最后，能够在控制台输入并输出表示我们成功过掉了反调试。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153013b1bedqsmj9eeoems.png" alt="10.png" title="10.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><h4 id="52512554_抓包分析">抓包分析</h4><p>我们直接点击<code>土地供应 -&gt; 供地计划</code>，会发一个<code>list</code>的包，请求头中的<code>Hash</code>参数就是需要逆向的参数。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153015u3gpcb136p4j6n9b.png" alt="11.png" title="11.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><h4 id="52512554_逆向分析">逆向分析</h4><p>一般请求头参数加密，我们可以通过<code>hook</code>的手段去找加密位置（可以去找现成的<code>hook</code>代码）。我选择直接从启动器去找了，一般都会看异步之前的<code>request</code>。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153017x46zlf0x50555f55.png" alt="12.png" title="12.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>下断，发包，然后找请求拦截器。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153019pk97q7c2zcd3m8oh.png" alt="13.png" title="13.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>很显然，下图大概率就是加密参数的生成位置。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153021rr2sn7q54nnr75rc.png" alt="14.png" title="14.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>我们在控制台输出一下结果，可以看到密文的长度为<code>64</code>，看起来很像<code>SHA256</code>。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153024hrgzpswyww4ep76r.png" alt="15.png" title="15.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>那我们就去尝试一下，看是否为标准的<code>SHA256</code>，字符串<code>'1'</code>的摘要为<code>6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22f1d49c01e52ddb7875b4b</code>。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153026kc719rll111ygtul.png" alt="16.png" title="16.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>再去控制台对字符串<code>'1'</code>进行摘要，经对比，算法是标准的，没有魔改。</p><p class=""><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153028cqv2y2j2bj9m94z8.png" alt="17.png" title="17.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p>那加密过程大概清楚了，对<code>userAgent</code>、<code>今天的日期（日）</code>以及<code>list</code>进行<code>SHA256</code>得到<code>Hash</code>。</p><p class=""><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153030m0tq0ywnw2knmdzm.png" alt="18.png" title="18.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p class="">那我们直接对接口进行请求模拟。</p><p><ignore_js_op><img src="https://attach.52pojie.cn/forum/202503/04/153032sxh0shd7ha7xe976.png" alt="19.png" title="19.png" border="0" class="zoom" style="max-width: 100%; max-height: 100%;"> </ignore_js_op></p><p class="">成功！！！</p></td></tr></tbody></table>

### 免费评分

<table class="ratl"><tbody><tr><th class="xw1" width="120"><a href="forum.php?mod=misc&amp;action=viewratings&amp;tid=2011345&amp;pid=52512554" onclick="showWindow('viewratings', this.href)" title="查看全部评分">参与人数 1</a></th><th class="xw1" width="80">吾爱币 <i>+1</i></th><th class="xw1" width="80">热心值 <i>+1</i></th><th><a href="javascript:;" onclick="toggleRatelogCollapse('ratelog_52512554', this);" class="y xi2 op">收起</a> <i class="txt_h">理由</i></th></tr></tbody><tbody class="ratl_l"><tr id="rate_52512554_2260153"><td><a href="home.php?mod=space&amp;uid=2260153" target="_blank"><img src="https://avatar.52pojie.cn/data/avatar/002/26/01/53_avatar_small.jpg" onerror="this.onerror=null;this.src='https://avatar.52pojie.cn/images/noavatar_small.gif'"></a> <a href="home.php?mod=space&amp;uid=2260153" target="_blank">meet52</a></td><td class="xi1">+ 1</td><td class="xi1">+ 1</td><td class="xg1">感谢发布原创作品，吾爱破解论坛因你更精彩！</td></tr></tbody></table>

[查看全部评分](forum.php?mod=misc&action=viewratings&tid=2011345&pid=52512554 "查看全部评分")